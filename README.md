# Kvartirka Comments
Api на django по тестовому заданию.

## Задание
Реализовать REST API для системы комментариев блога

## Запуск проекта
1. Скачайте или склонируйте проект.
2. Установите библиотеки из _requirements.txt_
3. Запустите postgres _(я использовал: psql (PostgreSQL) 12.10 (Ubuntu 12.10-0ubuntu0.20.04.1)
)_
   1. Создайте пользователя и БД. Если используете свои имена, их нужно поправить в _settings.py_
   2. Если не знакомы с psql. После установки в терминале введите команды:
   `sudo -u postgres psql postgres`
   3. Введите пароль
   4. В консоли postgres введите команды, _не забудьте про точку с запятой в конце строки_:
   ```
   create user kvartirka with password 'password';
   alter role kvartirka set client_encoding to 'utf8';
   create database kvartirka_comments_db owner kvartirka;
   ```
   5. Выходим из консоли postgres `\q`
4. Дальше всё как обычно:
   1. делаем миграцию `./manage.py migrate`,
   2. создаем суперпользователя `./manage.py createsuperuser`
   3. запускаем сервер `./manage runserver`.

## Работа с API
Проект создан на чистом Джанго без использования DRF. 

### Модели
#### User
* Стандартная джанго-модель пользователя. Ничего не изменено, но используется в связке с другими моделями.

* Через админ панель вы можете авторизоваться под созданным суперузером и добавить там новых пользоватлей при желании.

* CRUD настроен для всех без авторизации. Но в будущем, можно будет добавить эти настройки под конкретные категории пользоватлей.
#### Post
* Статья к которой крепятся комментарии. 
* Поле **content**. Для хранения текста.
* Поле **author**. Подставляется связка с авторизованным пользователем. Без авторизации поле будет возвращять _None_
#### Comment
* Сам комментарий. 
* Поле **post**. Привязка к статье.
* Поле **author**. Подставляется связка с авторизованным пользователем. Без авторизации поле будет возвращять _None_
* Поле **text**. Для хранения текста комментария.
* Поле **reply**. Рекурсивное поле. Делает связь с другими комментариями.

---
_Для тестирования запросов я использовал Postman. 
Дальнейшее описание я указываю при работе с локальным сервером. Не забывайте ставить закрывающий **/** в адресе!_
-----
### CRUD | статьи
#### Добавление статьи
* Ссылка: http://127.0.0.1:8000/api/post/
* Метод: POST
* json: ```{       
        "content": "Текст вашего поста"
}```
* правильный ответ: ```{
    "message": "Добавлена новая статья под номером: (id статьи)"
}```
* Чтобы привязать комментарий к посту. Укажите его id.
#### Просмотр всех статей
* Ссылка: http://127.0.0.1:8000/api/post/
* Метод: GET
* правильный ответ: 
```json 
{
    "posts": [
        {(Все посты с комменариями до 3 уровня вложенности)}
    ],
    "count": (количество постов в БД)
}
```
#### Просмотр конкретной статьи
* Ссылка: http://127.0.0.1:8000/api/post/ (id статьи)
* Метод: GET
* пример правильного ответа: 
```json 
{
    "id": 12,
    "content": "English post № 12",
    "author": "None",
    "comments": [
        {
            "id": 21,
            "post": 12,
            "text": "Первый комментарий первого уровня",
            "author": "None"
        }
    ]
}
```
* При наличии ответов к комментариям, добавляется поле **reply** в котором указывается все ответы к комментариям до 3 уровня.
#### Изменение статьи
* Ссылка: http://127.0.0.1:8000/api/post/ (id статьи)
* Метод: PUT
* Пример json: ```{       
        "content": "Обновленный пост № 12"
}```
* Пример удачного ответа: 
```json
{
  "message": "Статья под номером: 12 успешно изменена", 
  "post": {
    "id": 12, 
    "content": "Обновленный пост № 12", 
    "author": "None", 
    "comments": 
    [
      {
      "id": 21, 
      "post": 12, 
      "text": "Первый комментарий первого уровня", 
      "author": "None"
    }
    ]
  }
}
```
#### Удаление статьи
* Ссылка: http://127.0.0.1:8000/api/post/ (id статьи)
* Метод: DELETE
* Пример удачного ответа: ```{"message": "Статья под номером: 10 успешно удалена"}```

______
### CRUD | Комментарии
#### Добавление комментария
* Ссылка: http://127.0.0.1:8000/api/comment/
* Метод: POST
* Пример json: 
```json
{
    "post": 12,
    "text": "Первый комментарий второго уровня",
    "reply": 21
}
```
* Примечание: В **post** указываем id статьи. В **reply** указываем id комментария, к которому делаем комментарий. _Если это обычный комментарий, **reply** убираем из json_
* правильный ответ: 
`{ "message": "Добавлен новый комментарий(id22) к статье № 12." }`
#### Просмотр одного комментария (до 3 уровня вложенности)
* Ссылка: http://127.0.0.1:8000/api/comment/ (id комментария)
* Метод: GET
* пример правильного ответа: 
```json
{
    "id": 1,
    "post": 1,
    "text": "level 1",
    "author": "None",
    "reply": [
        {
            "id": 2,
            "post": 1,
            "text": "level 2",
            "author": "None"
        },
        {
            "id": 3,
            "post": 1,
            "text": "level 2",
            "author": "None",
            "reply": [
                {
                    "id": 4,
                    "post": 1,
                    "text": "level 3",
                    "author": "None"
                }
            ]
        }
    ]
}
```
#### Просмотр одного комментария и всех комментариев к нему в ответ
* Ссылка: http://127.0.0.1:8000/api/comment_all/ (id комментария)
* Метод: GET
* пример правильного ответа: 
```json
{
    "id": 7,
    "post": 2,
    "text": "Третий комментарий первого уровня",
    "author": "None",
    "reply": [
        {
            "id": 8,
            "post": 2,
            "text": "Первый комментарий второго уровня1",
            "author": "None"
        },
        {
            "id": 10,
            "post": 2,
            "text": "Второй комментарий второго уровня",
            "author": "None"
        },
        {
            "id": 11,
            "post": 2,
            "text": "Третий комментарий второго уровня",
            "author": "None",
            "reply": [
                {
                    "id": 13,
                    "post": 2,
                    "text": "Второй комментарий третьего уровня",
                    "author": "None",
                    "reply": [
                        {
                            "id": 15,
                            "post": 2,
                            "text": "Первый комментарий четвертого уровня",
                            "author": "None",
                            "reply": [
                                {
                                    "id": 16,
                                    "post": 2,
                                    "text": "Первый комментарий пятого уровня",
                                    "author": "None",
                                    "reply": [
                                        {
                                            "id": 17,
                                            "post": 2,
                                            "text": "Первый комментарий шестого уровня",
                                            "author": "None"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": 20,
                            "post": 2,
                            "text": "Второй комментарий четвертого уровня",
                            "author": "None"
                        }
                    ]
                },
                {
                    "id": 18,
                    "post": 2,
                    "text": "Первый комментарий третьего уровня",
                    "author": "None",
                    "reply": [
                        {
                            "id": 19,
                            "post": 2,
                            "text": "Первый комментарий четвертого уровня",
                            "author": "None"
                        }
                    ]
                }
            ]
        }
    ]
}
```
#### Изменение комментария
* Ссылка: http://127.0.0.1:8000/api/comment/ (id комментария)
* Метод: PUT
* Пример json: ```{
    "text": "Обновленный комментарий шестого уровня"
}```
* Пример удачного ответа: 
```json
{
  "message": "Комментарий id17 успешно изменен",
  "post": {
    "id": 17,
    "post": 2,
    "text": "Обновленный комментарий шестого уровня",
    "author": "None"
  }
}
```
#### Удаление комментария
* Ссылка: http://127.0.0.1:8000/api/comment/ (id комментария)
* Метод: DELETE
* Пример удачного ответа: ```{
    "message": "Комментарий id2 успешно удален"
}```



